<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<script src="https://kit.fontawesome.com/c49235a437.js" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
	<script src="https://canvasjs.com/assets/script/canvasjs.min.js"> </script>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
	<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.stock.min.js"></script>
	<title>Fill Threshold</title>
	<style>
		.display-5 {
			font-size: 1.5rem;
			font-weight: 100;
		}

		.card {
			border: 1px solid #F58883;
			box-shadow: 4px 4px rgba(245,136,131,0.12), 4px 4px rgba(245,136,131,0.12);
			margin: 50px 0;
		}

		.card-header {
			background-color: rgba(245,136,131,0.2);
    		border-bottom: 1px solid #F58883;
		}

		.card-footer {
			background-color: rgba(245,136,131,0.2);
    		border-top: 1px solid #F58883;
		}

		.card-text {
			margin-bottom: 5px;
		}

		.card-details {
			display: grid;
			grid-template-columns: 	repeat(2, 1fr);
		}

		.buttons {
			display: grid;
		    grid-template-columns: 1fr 1fr;
		    height: 20%;
		    grid-column-gap: 10px;
		    margin-top: 10%;
		}
	</style>
</head>
<body>


<!-- Modal -->
<div class="modal fade" id="exampleModalCenter1" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="exampleModalLongTitle">Company or Stakeholder's Name</h3>
        <button type="button" style="outline: none" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="company-details">
        	<div class="mb-3">
        		<h3 class="text-success">-------------- Analysis Report -------------</h3>
				<p class="text-muted mb-0">Sector Type --> ...</p>
				<p class="text-muted">Operating Region --> ...</p>
				<p class="text-muted mb-0">Concered Authority --> ...</p>
				<p class="text-muted">Type of Sector --> (Production, Transmission, Distribution) </p>

				<p class="text-muted mb-0">Date of Report --> ...</p>
				<p class="text-muted mb-0">Column1 Name --> ...</p>
				<p class="text-muted mb-0">Actual Production (in MWH) --> ...</p>
				<p class="card-text">Column1 Given Min Limit --> ...</p>
				<p class="card-text mb-4">Column1 Given Max Limit --> ...</p>

				<p class="text-muted mb-0">Absolute Deviation --> mod(average of given range - Actual Production)</p>
				<p class="text-muted mb-0">Percentage Deviation --> (Absolute Deviation/ (average of given range))*100</p>
				<p class="text-muted mb-0">Actions Required --> Determine Whether Production Should go up or Down</p>

			</div>
        </div>
      </div>
    </div>
  </div>
</div>

	<div class="container mt-5">
		<div class="mb-3">
			<p class="h3">Company or Stakeholder's Name</p>
			<p class="text-muted mb-0">Sector - ...</p>
			<p class="text-muted">Region - ...</p>
		</div>

		<div id="chartContainer1" style="height: 370px; width: 100%;"></div>

		<br><br>

		<div id="chartContainer2" style="height: 370px; width: 100%;"></div>

		<br><br>

		<table id="result">
			<thead>
			<tr></tr>
			</thead>
			<tbody>
				<tr></tr>
			</tbody>
		</table>
		<br><br>
		<div class="card">
		  <div class="card-header">
		    Company or Stakeholder's name
		  </div>
		  <div class="card-body">
		    <h5 class="card-title">Given the Regulatory Compliance limit the above Stakeholder was non-compliant on :-</h5>
		    <div class="card-details">
		    	<div>
				    <p class="card-text">Column1 Produced Output</p>
				    <p class="card-text">Column1 Given Min Limit</p>
				    <p class="card-text">Column1 Given Max Limit</p>
				</div>
				<div class="buttons">
					<button data-toggle="modal" data-target="#exampleModalCenter1" class="btn btn-success">View Details</button>
					<button data-toggle="modal" data-target="#exampleModalCenter1" class="btn btn-danger">Generate PDF</button>
				</div>
			</div>
		  </div>
		  <div class="card-footer">
		    Date of Report: 30/07/2020
		  </div>
		</div>

		<div class="card">
		  <div class="card-header">
		    Company or Stakeholder's name
		  </div>
		  <div class="card-body">
		    <h5 class="card-title">Given the Regulatory Compliance limit the above Stakeholder was non-compliant on :-</h5>
		    <div class="card-details">
		    	<div>
				    <p class="card-text">Column1 Produced Output</p>
				    <p class="card-text">Column1 Given Min Limit</p>
				    <p class="card-text">Column1 Given Max Limit</p>
				</div>
				<div class="buttons">
					<button data-toggle="modal" data-target="#exampleModalCenter1" class="btn btn-success">View Details</button>
					<button data-toggle="modal" data-target="#exampleModalCenter1" class="btn btn-danger">Generate PDF</button>
				</div>
			</div>
		  </div>
		  <div class="card-footer">
		    Date of Report: 30/07/2020
		  </div>
		</div>


		<div class="card">
		  <div class="card-header">
		    Company or Stakeholder's name
		  </div>
		  <div class="card-body">
		    <h5 class="card-title">Given the Regulatory Compliance limit the above Stakeholder was non-compliant on :-</h5>
		    <div class="card-details">
		    	<div>
				    <p class="card-text">Column1 Produced Output</p>
				    <p class="card-text">Column1 Given Min Limit</p>
				    <p class="card-text">Column1 Given Max Limit</p>
				</div>
				<div class="buttons">
					<button data-toggle="modal" data-target="#exampleModalCenter1" class="btn btn-success">View Details</button>
					<button data-toggle="modal" data-target="#exampleModalCenter1" class="btn btn-danger">Generate PDF</button>
				</div>
			</div>
		  </div>
		  <div class="card-footer">
		    Date of Report: 30/07/2020
		  </div>
		</div>


		<div class="card">
		  <div class="card-header">
		    Company or Stakeholder's name
		  </div>
		  <div class="card-body">
		    <h5 class="card-title">Given the Regulatory Compliance limit the above Stakeholder was non-compliant on :-</h5>
		    <div class="card-details">
		    	<div>
				    <p class="card-text">Column1 Produced Output</p>
				    <p class="card-text">Column1 Given Min Limit</p>
				    <p class="card-text">Column1 Given Max Limit</p>
				</div>
				<div class="buttons">
					<button data-toggle="modal" data-target="#exampleModalCenter1" class="btn btn-success">View Details</button>
					<button data-toggle="modal" data-target="#exampleModalCenter1" class="btn btn-danger">Generate PDF</button>
				</div>
			</div>
		  </div>
		  <div class="card-footer">
		    Date of Report: 30/07/2020
		  </div>
		</div>
	</div>
	<script type="text/javascript">
		window.onload = async function () {

		/*var chart = new CanvasJS.Chart("chartContainer", {
			animationEnabled: true,
			theme: "light2",
			title:{
				text: "Production Outputs"
			},
			data: [{        
				type: "line",
		      	indexLabelFontSize: 16,
				dataPoints: [
					{ x: 100, y: 450 },
					{ y: 414},
					{ y: 520, indexLabel: "\u2191 highest",markerColor: "red", markerType: "triangle" },
					{ y: 460 },
					{ y: 450 },
					{ y: 500 },
					{ y: 480 },
					{ y: 480 },
					{ y: 410 , indexLabel: "\u2193 lowest",markerColor: "DarkSlateGrey", markerType: "cross" },
					{ y: 500 },
					{ y: 480 },
					{ y: 510 }
				]
			}]
		});
		chart.render();*/

		var DataPointsa1 = [];
		var DataPointsa2 = [];
		var DataPointsb1 = [];
		var DataPointsb2 = [];
		var size = 25, refreshTime = 3000;

		var chart1 = new CanvasJS.Chart("chartContainer1", {
			animationEnabled: true,
			zoomEnabled: true,
			exportEnabled: true,
			theme: "light2",
			title:{
				text: "Power Distribution"
			},
			axisX:{
				valueFormatString: "DD MMM, HH:mm",
				crosshair: {
					enabled: true,
					snapToDataPoint: true
				}
			},
			axisY: {
				title: "MegaWatt(MW)",
				includeZero: true,
				crosshair: {
					enabled: true
				}
			},
			toolTip:{
				shared:true
			},  
			legend:{
				cursor:"pointer",
				verticalAlign: "bottom",
				horizontalAlign: "left",
				dockInsidePlotArea: true,
				itemclick: toogleDataSeries
			},
			data: [{
				type: "line",
				showInLegend: true,
				name: "Scheduled",
				markerType: "square",
				xValueFormatString: "DD MMM, HH:mm",
				color: "#F08080",
				dataPoints: DataPointsa1
			},
			{
				type: "line",
				showInLegend: true,
				name: "Drawl",
				lineDashType: "dash",
				xValueFormatString: "DD MMM, HH:mm",
				dataPoints: DataPointsa2
			}]
		});
		chart1.render();

		function toogleDataSeries(e){
			if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
				e.dataSeries.visible = false;
			} else{
				e.dataSeries.visible = true;
			}
			chart.render();
		}

		var chart2 = new CanvasJS.StockChart("chartContainer2",{
		    theme: "light2",
		    animationEnabled: true,
		    exportEnabled: true,
		    zoomEnabled: true,
		    title:{
		      text:"Power Distribution"
		    },
		    charts: [{
		      axisX: {
		        crosshair: {
		          enabled: true,
		          snapToDataPoint: true
		        }
		      },
		      axisY: {
		      	title: "MegaWatt(MW)",
		        suffix: "MW"
		      },
		      data: [{
		        type: "candlestick",
		        yValueFormatString: "#,###MW",
		        dataPoints : DataPointsb1
		      }]
		    }],
		    navigator: {
		      data: [{
		        dataPoints: DataPointsb2
		      }],
		      slider: {
		        minimum: new Date(2020, 8, 3, 10, 33, 30, 0),
		        maximum: new Date(2020, 8, 3, 10, 33, 50, 0)
		      }
		    }
		  });
		updateChart();
		
		function get_data() {
			//console.log("hi");
			var currentData;
			var table_name = '{{table_name}}';
			$.ajax({
		        method : "POST",
		        url:"{% url 'power:get_data' %}",
				async: false,
		        data : {
		            "table_name":table_name,
		            "csrfmiddlewaretoken": '{{ csrf_token }}',
		        },
		        success : function(result){
					//console.log(result);
		           	currentData = result;
		        }
		    });
		    //console.log(currentData);
			return currentData;
		}

		function updateChart() {
			var currentData = get_data();
			//var currentData = {'0': [], '1': [10246, 10245]};
			console.log(currentData);
			//console.log(currentData2);

			var colNames = currentData['0'];
			var colValues = currentData['1'];
			//console.log(currentData);
			console.log('colNames', colValues[0]);
			console.log('colValues', colValues[1]);

			DataPointsa1.push({
						x: new Date(),
						y: colValues[0]
					});

			DataPointsa2.push({
						x: new Date(),
						y: colValues[1]
					});
			if(DataPointsa1.length > size) 
				DataPointsa1.shift();
			if(DataPointsa2.length > size) 
				DataPointsa2.shift();
			chart1.render();
			console.log(DataPointsa1);
			console.log(DataPointsa2);


			let yval1 = colValues[0], yval2 = colValues[1];
			DataPointsb1.push({
						x: new Date(),
						y: [yval1, 0, 0, yval2]
					});

			DataPointsb2.push({
						x: new Date(),
						y: yval2
					});
			if(DataPointsb1.length > size) 
				DataPointsb1.shift();
			if(DataPointsb2.length > size) 
				DataPointsb2.shift();
			chart2.render();
			console.log(DataPointsb1)
			console.log(DataPointsb2);


			setTimeout(function(){updateChart()}, refreshTime);
		}
	}
	</script>
</body>
</html>



